{% extends 'base.html' %}
{% block content %}
<div class="container mt-5">
    <h2 class="mb-4"><i class="bi bi-calendar-x"></i> Liste des Absences</h2>

    <div class="row mb-3">
        <div class="col-md-4"><strong>Absences totales :</strong> {{ total }}</div>
        <div class="col-md-4 text-success"><strong>Justifi√©es :</strong> {{ justifiees }}</div>
        <div class="col-md-4 text-danger"><strong>Non justifi√©es :</strong> {{ non_justifiees }}</div>
    </div>

    <a href="{% url 'ajouter_absence' %}" class="btn btn-primary mb-3">
        <i class="bi bi-plus-circle"></i> Ajouter une absence
    </a>
    <form method="get" class="row g-2 mb-3">
    <div class="col-md-4">
        <select name="eleve" class="form-select">
            <option value="">-- Tous les √©l√®ves --</option>
            {% for e in eleves %}
            <option value="{{ e.id }}" {% if request.GET.eleve == e.id|stringformat:"s" %}selected{% endif %}>
                {{ e.nom }}
            </option>
            {% endfor %}
        </select>
    </div>
    <div class="col-md-3">
        <select name="justifiee" class="form-select">
            <option value="">-- Toutes absences --</option>
            <option value="true" {% if request.GET.justifiee == 'true' %}selected{% endif %}>Justifi√©es</option>
            <option value="false" {% if request.GET.justifiee == 'false' %}selected{% endif %}>Non justifi√©es</option>
        </select>
    </div>
    <div class="col-md-2">
        <button type="submit" class="btn btn-outline-primary w-100">Filtrer</button>
    </div>
</form>


    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>√âl√®ve</th>
                <th>Date</th>
                <th>Motif</th>
                <th>Justifi√©e ?</th>
            </tr>
        </thead>
        <tbody>
    {% for absence in absences %}
    <tr>
        <td>{{ absence.eleve.nom }}</td>
        <td>{{ absence.date }}</td>
        <td>{{ absence.motif|default:"‚Äî" }}</td>
        <td>
            {% if absence.justifiee %}
                <span class="badge bg-success">Oui</span>
            {% else %}
                <span class="badge bg-danger">Non</span>
            {% endif %}
        </td>
        <td>
            <a href="{% url 'modifier_absence' absence.id %}" class="btn btn-sm btn-warning">‚úèÔ∏è Modifier</a>
            <a href="{% url 'supprimer_absence' absence.id %}" class="btn btn-sm btn-danger">üóëÔ∏è Supprimer</a>
        </td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="5" class="text-center text-muted">Aucune absence enregistr√©e.</td>
    </tr>
    {% endfor %}
</tbody>

    </table>
</div>
<canvas id="statsChart" width="400" height="200"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const justifiees = Number('{{ justifiees|default:0 }}');
    const nonJustifiees = Number('{{ non_justifiees|default:0 }}');

    const ctx = document.getElementById('statsChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Justifi√©es', 'Non justifi√©es'],
            datasets: [{
                label: 'R√©partition des absences',
                data: [justifiees, nonJustifiees],
                backgroundColor: ['#28a745', '#dc3545']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom',
                },
                title: {
                    display: true,
                    text: 'Statistiques des absences'
                }
            }
        }
    });
</script>


{% endblock %}

  





