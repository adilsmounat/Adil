{% extends 'base.html' %}
{% load form_filters %}

{% block content %}
<!-- Ajoute dans ton fichier de base ou dans cours_classe.html -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<div class="container mt-5">
  <h2 class="text-center mb-5 text-primary animate__animated animate__fadeInDown">
    ğŸ“˜ <strong>Mes Cours</strong>
  </h2>
 <div class="text-center mt-4">
    <a href="{% url 'selection_jeu' %}" class="btn btn-warning">
        ğŸ® Lancer le mini-jeu Ã©ducatif
    </a>
</div>



  
 
 


  {% if cours %}
    <div class="row gy-4">
      {% for cours_item in cours %}
        <div class="col-12">
          <div class="card shadow-lg border-0">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
              <h5 class="mb-0 text-primary">
                ğŸ“š {{ cours_item.nom }}
              </h5>
              {% if cours_item in cours_termines %}
                <span class="badge bg-success px-3 py-2">âœ… TerminÃ©</span>
              {% else %}
                <span class="badge bg-warning text-dark px-3 py-2">â³ Ã€ faire</span>
              {% endif %}
            </div>

            <div class="card-body">
              <p class="text-muted">{{ cours_item.description|default:"Aucune description." }}</p>

              {% if cours_item.fichier_pdf %}
                <div class="d-flex flex-wrap align-items-center gap-3 mb-3">
                  <a href="{{ cours_item.fichier_pdf.url }}" target="_blank" class="btn btn-outline-primary btn-sm">
                    ğŸ“– Voir le PDF
                  </a>
                  <a href="{{ cours_item.fichier_pdf.url }}" download class="btn btn-outline-success btn-sm">
                    â¬‡ï¸ TÃ©lÃ©charger le PDF
                  </a>
                </div>
              {% else %}
                <p class="text-danger">
                  âŒ Aucun fichier PDF disponible pour ce cours.
                </p>
              {% endif %}

              <hr class="my-4">

              {% if cours_item.quizz.all %}
                <div class="row g-3">
                  {% for quiz in cours_item.quizz.all %}
                    <div class="col-md-6 col-lg-4">
                      <div class="card border-0 h-100 shadow-sm animate__animated animate__fadeInUp">
                        <div class="card-body d-flex flex-column justify-content-between">
                          <h6 class="card-title text-dark">
                            ğŸ“ {{ quiz.titre|default:"Sans titre" }}
                          </h6>
                          <a href="{% url 'passer_quiz' quiz.id %}"
                             class="btn btn-outline-success btn-sm mt-auto w-100">
                            ğŸ¯ Faire le test
                          </a>
                        </div>
                      </div>
                    </div>
                  {% endfor %}
                </div>
              {% else %}
                <p class="text-muted mt-2">ğŸš« Aucun quiz disponible pour ce cours.</p>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-warning text-center mt-5">
      Aucun cours trouvÃ© pour ta classe ({{ eleve.classe }}).
    </div>
  {% endif %}
</div>
<!-- ğŸ’¬ MODAL CHATBOT -->
<div class="modal fade" id="chatbotModal" tabindex="-1" aria-labelledby="chatbotModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title" id="chatbotModalLabel">ğŸ“ Mon assistant Ã©ducatif</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
      </div>

      <div class="modal-body" style="height: 500px;">
        <iframe src="{% url 'chatbot' %}" style="width:100%; height:100%; border:none;"></iframe>
      </div>

    </div>
  </div>
</div>
<!-- ğŸ¤– Bulle flottante pour ouvrir le chatbot -->
<div id="chatbot-bubble" style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #28a745;
    color: white;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    text-align: center;
    line-height: 60px;
    font-size: 28px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    cursor: pointer;
    z-index: 1055;">
    ğŸ¤–
</div>

<!-- ğŸ§  FenÃªtre flottante du chatbot -->
<div id="chatbot-frame" style="
    display: none;
    position: fixed;
    bottom: 90px;
    right: 20px;
    width: 420px;
    height: 500px;
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 0 15px rgba(0,0,0,0.4);
    z-index: 1055;">
    <iframe src="{% url 'chatbot' %}" style="width: 100%; height: 100%; border: none;"></iframe>
</div>

<!-- ğŸš€ JS pour gÃ©rer l'ouverture automatique et le clic -->
<!-- ğŸ’¬ Bulle flottante Chatbot -->
<div id="chatbot-bubble" style="
    position: fixed;
    bottom: 25px;
    right: 25px;
    width: 60px;
    height: 60px;
    background-color: #28a745;
    color: white;
    border-radius: 50%;
    text-align: center;
    line-height: 60px;
    font-size: 28px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    cursor: pointer;
    z-index: 2000;
">
    ğŸ¤–
</div>

<!-- ğŸ§  FenÃªtre chatbot amÃ©liorÃ©e -->
<!-- Bulle flottante -->
<div id="chatbot-toggle" style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 60px;
    height: 60px;
    background-color: #28a745;
    color: white;
    font-size: 28px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 9999;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
">ğŸ¤–</div>

<!-- FenÃªtre du chatbot -->
<div id="chatbot-box" style="
    position: fixed;
    bottom: 90px;
    right: 20px;
    width: 400px;
    height: 520px;
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 0 18px rgba(0,0,0,0.25);
    display: none;
    flex-direction: column;
    overflow: hidden;
    z-index: 9998;
    border: 1px solid #ccc;
    animation: fadeInUp 0.3s ease;
">
    <div style="background-color: #28a745; padding: 10px 16px; color: white; display: flex; justify-content: space-between; align-items: center;">
        <strong>ğŸ“ Mon assistant Ã©ducatif</strong>
        <button id="chatbot-close" style="background: none; border: none; color: white; font-size: 20px;">Ã—</button>
    </div>
    <iframe src="{% url 'chatbot' %}" style="flex-grow: 1; border: none;"></iframe>
</div>

<style>
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const bubble = document.getElementById("chatbot-toggle");
    const box = document.getElementById("chatbot-box");
    const close = document.getElementById("chatbot-close");

    let chatbotAlreadyOpened = false;

    // Bulle clic -> toggle affichage
    bubble.addEventListener("click", function () {
        box.style.display = (box.style.display === "flex") ? "none" : "flex";
    });

    // Bouton fermeture
    close.addEventListener("click", function () {
        box.style.display = "none";
    });

    // Auto-ouverture aprÃ¨s 2 secondes (une seule fois)
    setTimeout(() => {
        if (!chatbotAlreadyOpened) {
            box.style.display = "flex";
            chatbotAlreadyOpened = true;
        }
    }, 2000);
});
</script>


{% endblock %}
